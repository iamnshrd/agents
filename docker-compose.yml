services:
  session:
    image: polymarket-agents:latest
    container_name: agents-session
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - ENABLE_RAG=false
      - CHROMADB_DISABLE_TELEMETRY=true
    volumes:
      - ./logs:/home/logs
    command: >
      sh -c "python -c 'from agents.application.dry_run_trader import DryRunTrader; t=DryRunTrader(); t.run_session(num_trades=999999, pause_secs=10)'"
    depends_on:
      api:
        condition: service_healthy
    healthcheck:
      test: ["CMD-SHELL", "pgrep -f agents.application.dry_run_trader || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 30s

  telegram:
    image: polymarket-agents:latest
    container_name: agents-telegram
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - ./logs:/home/logs
    command: >
      sh -c "python -c 'import asyncio; from agents.connectors.telegram import telegram_bot_poll; asyncio.run(telegram_bot_poll())'"

  api:
    image: polymarket-agents:latest
    container_name: agents-api
    restart: unless-stopped
    env_file:
      - .env
    ports:
      - "8000:8000"
    command: >
      sh -c "uvicorn scripts.python.server:app --host 0.0.0.0 --port 8000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 5s
      retries: 3

networks:
  default:
    driver: bridge


